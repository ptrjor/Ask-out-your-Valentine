<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="A cute Valentine's Day page to ask someone to be your Valentine!">
  <meta name="theme-color" content="#ffd0e5">
  <title>Valentine's Day</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
  <style>
    .gradient-background {
      background: linear-gradient(180deg, #ffd0e5 0%, #ffe8f2 36%, #ffffff 100%);
      min-height: 100vh;
    }

    .bounce {
      animation: bounce 2s ease infinite;
    }

    @keyframes bounce {
      0%, 20%, 50%, 80%, 100% {
        transform: translateY(0);
      }
      40% {
        transform: translateY(-20px);
      }
      60% {
        transform: translateY(-10px);
      }
    }
  </style>
  <!-- Preload images so transitions feel instant -->
  <link rel="preload" as="image" href="./images/image1.gif">
  <link rel="preload" as="image" href="./images/oss.jpg">
  <link rel="preload" as="image" href="./images/img2.jpg">
  <link rel="preload" as="image" href="./images/image3.gif">
  <link rel="preload" as="image" href="./images/image4.gif">
  <link rel="preload" as="image" href="./images/image5.gif">
  <link rel="preload" as="image" href="./images/image6.gif">
  <link rel="preload" as="image" href="./images/image7.gif">
</head>
<body class="gradient-background">
  <main class="flex items-center justify-center h-screen">
    <section class="flex flex-col items-center p-4">
      <img
        id="imageDisplay"
        src="./images/image1.gif"
        alt="Cute kitten with flowers"
        class="rounded-md h-[300px] object-cover"
      />
       <img
        id="ossImage"
        src="./images/oss.jpg"
        alt="Cute kitten with flowers"
        class="rounded-md h-[300px] object-cover"
      />
      <!-- /* center this h1 -->


    <h1
  id="valentineQuestion"
  class="text-4xl font-bold italic text-[#bd1e59] my-4 text-center"
>
  Vil du bi min Valentine?
</h1>

      <div id="responseButtons" class="flex gap-4 pt-5 items-center">
        <button
          id="yesButton"
          class="bounce inline-flex items-center justify-center whitespace-nowrap rounded-md text-xl font-medium cursor-pointer px-4 py-2 bg-green-500 text-white transition-all duration-300 ease-in-out hover:bg-green-400 min-h-12 min-w-[75px]"
        >
          Ja
        </button>
        <button
          id="noButton"
          class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-xl font-medium cursor-pointer px-4 py-2 bg-red-500 text-white transition-colors hover:bg-red-700 h-12 min-w-[75px]"
        >
          Nei
        </button>
      </div>
      <p id="saveStatus" class="mt-4 text-sm text-[#bd1e59]"></p>
    </section>
  </main>

<script>
  window.VALENTINE_CONFIG = {
    googleFormActionUrl: 'https://docs.google.com/forms/d/e/1FAIpQLSe_A6ExjetfsrVo6zSGpn16CrqM3J6NSvT6CdPV-4fSGLhHJw/formResponse',
    googleFormAnswerEntry: 'entry.86242847',
    // googleFormVisitorEntry: '',
    // notifyWebhookUrl: ''
  };
</script>



  <script>
    (() => {
      // DOM references
      const yesButton = document.getElementById('yesButton');
      const noButton = document.getElementById('noButton');
      const imageDisplay = document.getElementById('imageDisplay');
      const valentineQuestion = document.getElementById('valentineQuestion');
      const responseButtons = document.getElementById('responseButtons');
      const saveStatus = document.getElementById('saveStatus');

      // Optional runtime config. Add a script tag before this one to override values:
      // window.VALENTINE_CONFIG = {
      //   googleFormActionUrl: 'https://docs.google.com/forms/d/e/<form-id>/formResponse',
      //   googleFormAnswerEntry: 'entry.1234567890',
      //   googleFormVisitorEntry: 'entry.0987654321', // optional
      //   notifyWebhookUrl: 'https://ntfy.sh/<topic>' // optional
      // }
      const CONFIG = {
        googleFormActionUrl: '',
        googleFormAnswerEntry: '',
        googleFormVisitorEntry: '',
        notifyWebhookUrl: '',
        ...(window.VALENTINE_CONFIG || {}),
      };

      // Configuration
      const GROWTH_PER_CLICK = 35;
      const FONT_GROWTH_PER_CLICK = 25;
      const MAX_NO_CLICKS = 5;

      const IMAGE_PATHS = [
        './images/image1.gif',
        './images/image2.gif',
        './images/image3.gif',
        './images/image4.gif',
        './images/image5.gif',
        './images/image6.gif',
        './images/image7.gif',
      ];

      const NO_BUTTON_MESSAGES = [
        'No',
        'Are you sure?',
        'Pookie please',
        "Don't do this to me :(",
        "You're breaking my heart",
        "I'm gonna cry...",
      ];

      const ALT_TEXTS = [
        'Cute kitten with flowers',
        'Sad kitten looking up',
        'Kitten begging',
        'Heartbroken kitten',
        'Crying kitten',
        'Devastated kitten',
        'Happy kitten celebrating',
      ];

      // State
      let noClickCount = 0;
      let buttonHeight = 48;
      let buttonWidth = 80;
      let fontSize = 20;
      let hasSavedNo = false;

      const getVisitorId = () => {
        const storageKey = 'valentine_visitor_id';
        let id = localStorage.getItem(storageKey);

        if (!id) {
          id = `visitor-${crypto.randomUUID()}`;
          localStorage.setItem(storageKey, id);
        }

        return id;
      };

      const setStatus = (message, colorClass = 'text-[#bd1e59]') => {
        saveStatus.className = `mt-4 text-sm ${colorClass}`;
        saveStatus.textContent = message;
      };

      const recordAnswer = async (answer) => {
        const { googleFormActionUrl, googleFormAnswerEntry, googleFormVisitorEntry, notifyWebhookUrl } = CONFIG;

        if (!googleFormActionUrl || !googleFormAnswerEntry) {
          setStatus('Tip: add Google Form settings in VALENTINE_CONFIG to save answers.');
          return;
        }

        try {
          const visitorId = getVisitorId();
          const formBody = new URLSearchParams();
          formBody.set(googleFormAnswerEntry, answer);

          if (googleFormVisitorEntry) {
            formBody.set(googleFormVisitorEntry, visitorId);
          }

          // Google Forms does not return CORS headers for browser JS, so `no-cors` is expected here.
          // The request still gets recorded in the linked response sheet.
          await fetch(googleFormActionUrl, {
            method: 'POST',
            mode: 'no-cors',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8' },
            body: formBody.toString(),
          });

          if (notifyWebhookUrl) {
            await fetch(notifyWebhookUrl, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                text: `Valentine response: ${answer}`,
                answer,
                visitorId,
              }),
            });
          }

          setStatus('Svar sendt ;) ', 'text-green-700');
        } catch (error) {
          setStatus('Could not send answer. Check your Google Form config.', 'text-red-700');
          console.error(error);
        }
      };

      noButton.addEventListener('click', () => {
        if (noClickCount >= MAX_NO_CLICKS) return;

        noClickCount++;

        // Update image and alt text
        imageDisplay.src = IMAGE_PATHS[noClickCount];
        imageDisplay.alt = ALT_TEXTS[noClickCount];

        // Grow the "Yes" button to make it harder to ignore
        buttonHeight += GROWTH_PER_CLICK;
        buttonWidth += GROWTH_PER_CLICK;
        fontSize += FONT_GROWTH_PER_CLICK;

        yesButton.style.height = `${buttonHeight}px`;
        yesButton.style.width = `${buttonWidth}px`;
        yesButton.style.fontSize = `${fontSize}px`;

        // Update "No" button text with increasingly desperate messages
        noButton.textContent = NO_BUTTON_MESSAGES[noClickCount];

        if (!hasSavedNo) {
          hasSavedNo = true;
          void recordAnswer('no');
        }
      });

      yesButton.addEventListener('click', () => {
        // Update UI text and hide response buttons
        valentineQuestion.textContent = 'YEY!! <3';
        responseButtons.style.display = 'none';

  // Remove the oss.jpg image from the DOM if present
  const ossImg = document.getElementById('ossImage');
  if (ossImg) ossImg.remove();

        // Try to show ./images/img2.jpg when the user says yes.
        // If that file doesn't exist, try './images/oss.jpg' (already in repo),
        // then fall back to the existing final gif.
        const tryLoad = (src, onSuccess, onFail) => {
          const img = new Image();
          img.onload = () => onSuccess(src);
          img.onerror = onFail;
          img.src = src;
        };

        tryLoad('./images/img2.jpg', (s) => {
          imageDisplay.src = s;
          imageDisplay.alt = 'Celebration image';
        }, () => {
       
        });

        // Heart-shaped confetti for a valentine theme
        const heart = confetti.shapeFromPath({
          path: 'M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z',
        });

        const defaults = { spread: 360, ticks: 100, gravity: 0, decay: 0.94, startVelocity: 20, shapes: [heart], colors: ['#ff69b4', '#ff1493', '#ff6b81', '#e84393'] };

        confetti({ ...defaults, particleCount: 50, scalar: 2 });
        confetti({ ...defaults, particleCount: 25, scalar: 3 });
        confetti({ ...defaults, particleCount: 10, scalar: 4 });

        void recordAnswer('yes');
      });
    })();
  </script>
</body>
</html>
